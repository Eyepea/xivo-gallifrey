## /bin/sh -e simulate dpatch for prepend_chlog.py
## 40_initgroups.dpatch by Kilian Krause <kk@verfaction.de>
## DP: does initialize groups of asterisk user if no -G is given.
## -- applied upstream for 1.2

Index: asterisk-1.2.27/asterisk.c
===================================================================
--- asterisk-1.2.27.orig/asterisk.c	2008-03-19 11:33:02.000000000 +0100
+++ asterisk-1.2.27/asterisk.c	2008-03-19 11:33:05.000000000 +0100
@@ -2243,6 +2243,10 @@
 				exit(1);
 			}
 		}
+		if (!rungroup && initgroups(runuser, pw->pw_gid)) {
+			ast_log(LOG_WARNING, "Unable to initialize supplementary group list for %s\n", runuser);
+			exit(1);
+		}
 		if (setuid(pw->pw_uid)) {
 			ast_log(LOG_WARNING, "Unable to setuid to %d (%s)\n", (int)pw->pw_uid, runuser);
 			exit(1);
