## /bin/sh -e simulate dpatch for prepend_chlog.py
## Bug
## 99_CVE-2006-2898.dpatch by Joey Schulze <joey@debian.org>
## DP: Bug in the IAX2 channel allows remote attackers to craft
## DP: a denial of service.

Index: asterisk-1.2.27/channels/chan_iax2.c
===================================================================
--- asterisk-1.2.27.orig/channels/chan_iax2.c	2008-03-19 11:32:46.000000000 +0100
+++ asterisk-1.2.27/channels/chan_iax2.c	2008-03-19 11:32:55.000000000 +0100
@@ -6656,7 +6656,7 @@
 	if (iaxdebug && (res >= sizeof(*fh)))
 		iax_showframe(NULL, fh, 1, &sin, res - sizeof(*fh));
 #endif
-	if (ntohs(mh->callno) & IAX_FLAG_FULL) {
+	if ((res >= sizeof(*fh)) && ntohs(mh->callno) & IAX_FLAG_FULL) {
 		if (res < sizeof(*fh)) {
 			ast_log(LOG_WARNING, "Rejecting packet from '%s.%d' that is flagged as a full frame but is too short\n", ast_inet_ntoa(iabuf, sizeof(iabuf), sin.sin_addr), ntohs(sin.sin_port));
 			return 1;
