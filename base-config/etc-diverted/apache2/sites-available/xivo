
NameVirtualHost *:443

<VirtualHost *:443>
	SSLEngine on
	SSLOptions +FakeBasicAuth +StrictRequire +StdEnvVars +ExportCertData
	SSLProtocol all
	SSLCipherSuite RSA:!EXP:!NULL:+HIGH:+MEDIUM:-LOW
	SSLCertificateFile /etc/apache2/cert/server.crt
	SSLCertificateKeyFile /etc/apache2/cert/server.key
	SSLCACertificatePath /etc/ssl/certs/
	SSLCACertificateFile /etc/ssl/certs/proformatique.crt
	SSLVerifyClient none

	Include "/usr/share/pf-xivo-web-interface/apache.conf"
</VirtualHost>


NameVirtualHost *:8667

<VirtualHost *:8667>
	DocumentRoot /tftpboot/

	ErrorLog /var/log/apache2/xivo_error_provi_http.log
	CustomLog /var/log/apache2/xivo_access_provi_http.log combined

	<Directory />
		Options FollowSymLinks
		AllowOverride None
	</Directory>
</VirtualHost>

NameVirtualHost *:80

<VirtualHost *:80>
	RewriteEngine On
	RewriteCond %{HTTPS} off
	# XXX Snom phones don't work with SSL
	RewriteCond %{HTTP_USER_AGENT} !snom3[026]0-
	RewriteRule .* https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

	<Location />
		Deny from all
	</Location>

	<Location /service/ipbx/web_services.php/phonebook/search>
		Allow from all
	</Location>

	Include "/usr/share/pf-xivo-web-interface/apache.conf"
</VirtualHost>
